---
title: "Projeto Data Mining I"
author: "Lucas Parada, Ana Catarina Monteiro, Lucas de Paula"
date: "11/16/2019"
output: pdf_document
---


# Data importation, clean-up and pre-processing
<!-- 
In this part of your work you should focus on importing the provided data into an appropriate R format so
that your posterior analysis is made simpler. You should also check if it is necessary to carry out any data
clean-up and/or pre-processing steps.
-->
## Importando os Dados
Inicialmente importamos todos as bibliotecas que utilizaresmos neste trabalho
Foi importado o dataset "PRSA_Data_Aotizhongxin_20130301-20170228"
&nbsp;
 - Foi utilizado o DataFrame do R para manipular os dados, pois este tipo de estrutura de dados possui um conjunto de funcionalidades e ferrantas que auxiliam neste processo
```{r}
library(na.tools)
library(naniar)
library(dplyr)
library(zoo)
library(ggplot2)
library(caret)
library(tidyimpute)
library("ggplot2")

df = read.csv('data/PRSA_Data_Aotizhongxin_20130301-20170228.csv')
```
## Analisando os dados
Utilizando a função "summary" da linguagem R foi feita uma análise dos dados.

```{r}
summary(df)
```
Começamos por verificar se existia algum dia em falta no dataframe e vimos que nao.
Samendo que o dataset possui os valores referentes a 4 anos completos especificados por hora então sevem existir (4*365+1)*24 = 35064 rows

```{r}
  #samendo que o dataset possui os valores referentes a 4 anos completos especificados por hora então sevem existir (4*365+1)*24 = 35064 rows
dim(df)
```

## Outliers
Seguimos com a analise da existencia de outliers em variáveis numericas. Começando por ver fazer a análise por variavel como um todo, em seguida fizemos a análise por variavel tendo em conta a estação do ano e por último por variavel por mês.

### Como um todo
```{r}
col_list = c("CO", "PM2.5", "PM10", "SO2", "NO2", "CO", "O3", "TEMP", "PRES", "DEWP", "RAIN", "WSPM")

df_ALL_boxplot <- df %>% select(col_list)
df_ALL_boxplot <- scale(df_ALL_boxplot)

boxplot(x = df_ALL_boxplot)

#for(i in col_list){
#  plot(df[i], pch=".", cex=2, main=i)  # plot cook's distance
#  abline(h = 4*mean(c(df[i]), na.rm=T), col="red")  # add cutoff line
#}
#text(x=1:length(df$CO)+1, y=df$CO, labels=ifelse(df$CO>4*mean(df$CO, na.rm=T),names(df$CO),""), col="red")  # add labels
```
Como 

### Por estação do ano
```{r}
col_list = c("season","CO", "PM2.5", "PM10", "SO2", "NO2", "CO", "O3", "TEMP", "PRES", "DEWP", "RAIN", "WSPM")
df_seasons_boxplot <- df %>% mutate(season = 
                                ifelse(month == 12 & day >= 21, 'winter', 
                                ifelse(month == 1 | month == 2, 'winter', 
                                ifelse(month == 3 & day < 20, 'winter', 
                                       
                                ifelse(month == 3 & day >= 20, 'spring', 
                                ifelse(month == 4 | month == 5, 'spring', 
                                ifelse(month == 6 & day < 21, 'spring', 
                                       
                                ifelse(month == 6 & day >= 21, 'summer', 
                                ifelse(month == 7 | month == 8, 'summer', 
                                ifelse(month == 9 & day < 21, 'summer', 
                                       
                                ifelse(month == 9 & day >= 21, 'autumn', 
                                ifelse(month == 10 | month == 11, 'autumn', 
                                ifelse(month == 12 & day < 21, 'autumn', 
                                       
                                       0))))))))))))) %>%
                      select(col_list)

for(s in df_seasons_boxplot$season %>% unique()){
   df_seasons_boxplot %>% filter(season == s) %>% select(-season) %>% scale() %>% boxplot(main=s)
}
```

### Por mês
```{r}
col_list = c("month", "CO", "PM2.5", "PM10", "SO2", "NO2", "CO", "O3", "TEMP", "PRES", "DEWP", "RAIN", "WSPM")


df_month_boxplot <- df %>% select(col_list)
month_names <- c("January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December")
for(m in df_month_boxplot$month %>% unique()){
   df_month_boxplot %>% filter(month == m) %>% select(-month) %>% scale() %>% boxplot(main=month_names[m])
}

df_month_boxplot %>% group_by(month) %>% select(-month) %>% scale() %>% boxplot()



```




Apartir da análise mencionada anteriormente foi identificada que as varáveis "PM2.5", "PM10", "SO2", "NO2", "CO", "O3", "TEMP", "PRES", "DEWP", "RAIN", "wd", "WSPM" possuem missing values.



Em seguida foi uma análise e foi verificado que as variáveis "TEMP", "PRES", "DEWP", "RAIN" esta a faltar no mesmo dia atravez do gráfico:
```{r}

#check missing values
#df %>% select(RAIN, TEMP, PRES, wd, WSPM) %>% filter_any_na()
gg_miss_var(df, facet = month)

#for(col_name in c('TEMP', 'PRES', 'DEWP', 'RAIN')){
#  (df %>% mutate(test_col = ifelse(is_na(TEMP), 1, 0)))$test_col %>% plot(pch=".", cex=2, main=col_name)  # plot cook's distance
#  abline(h = 4*mean(c(df[col_name]), na.rm=T), col="red")  # add cutoff line
#}

```









## Data Analisys
```{r}
head(df, 20)
summary(df)
dim(df)
```

## Check Outliers
Verificamos para cada uma das colunas se existem valores outliers
Para isso plotamos os dados utilizando o boxplot
....
```{r}
#df %>% group_by(month) %>% ggplot(aes(group = month, y = TEMP)) + geom_boxplot()
#temp_out <- boxplot(TEMP~month+year , data=df)$out
#temp_out <- boxplot(df$TEMP~month)$out

#ed_exp1 <- df[c(10:21),c(2,6:7)]

#df_new <- df[-which(df$TEMP %in% temp_out),]
#boxplot(TEMP~month+year , data=df_new)

#boxplot(df.NEW_TEMP$TEMP)
#boxplot(df$TEMP)
```



### Missing Values
```{r}
#function interpolation
interpolation_df <- function(df, col_names ){
  for(col in col_names){
    df[col] <- na.approx(df[col], rule=2)
  }
  return(df)
}

head(df)
col_names = c("PM2.5", "PM10", "SO2", "NO2", "CO", "O3", "TEMP", "PRES", "DEWP", "RAIN", "WSPM")
df <- interpolation_df(df, col_names)
gg_miss_var(df, facet = month)

#falta remover os missing values da coluna wd
#sum(is.na(df$wd))
```

### Calc a class variable
```{r}
df$aqi<-NA
df[, "aqi"] <- apply(df[, 6:11], 1, max)

head(df)
```




# Data exploratory analysis
<!-- 
This part involves summarising and visualising the data in forms that you think are useful. Try to think
about interesting questions that could be interesting to check with the available data, and provide answers
either using textual summaries or data visualisation.
-->

# Predictive modelling
<!-- 
You should define a predictive task that can help to predict the air pollution, through the AQI value or Air
Pollution Level, given its feature values. After defining the task, you should use your available data to select
and obtain a good model for this task. Justify your suggested model.
-->